<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stock Market — 내 홈페이지</title>
  <meta name="description" content="S&P 500 대표 종목 인터랙티브 차트 & 최신 뉴스" />
  <style>
    :root{ --bg:#0f172a; --panel:#111827ee; --text:#e5e7eb; --muted:#9aa3af; --accent:#60a5fa; --accent-2:#34d399; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;background:radial-gradient(1200px 800px at 80% -10%,#1f2937 0%,#0b1225 50%,#020617 100%);color:var(--text)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline;opacity:.9}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    header{position:sticky;top:0;backdrop-filter:saturate(140%) blur(8px);background:#030712aa;border-bottom:1px solid #111827;z-index:50}
    nav{display:flex;justify-content:space-between;align-items:center;gap:16px}
    .brand{font-weight:800;letter-spacing:.2px}
    .brand span{color:var(--accent)}
    .navlinks{display:flex;gap:18px;flex-wrap:wrap}
    .btn{display:inline-block;padding:10px 16px;border-radius:12px;border:1px solid #1f2937;background:#0b1220}
    .btn.primary{background:linear-gradient(135deg,var(--accent),#7dd3fc);color:#02131e;border-color:transparent;font-weight:700}
    .grid{display:grid;gap:18px}
    @media(min-width:1024px){ .grid.cols-2{grid-template-columns:300px 1fr} }
    .card{background:linear-gradient(180deg,#0b1220 0%,#0a0f1a 100%);border:1px solid #111827;border-radius:18px;padding:18px}
    .section-title{display:flex;align-items:center;gap:10px;margin:0 0 12px}
    .section-title .bar{width:28px;height:2px;background:var(--accent);opacity:.8}
    .muted{color:#9aa3b2}
    .footer{border-top:1px solid #111827;margin-top:28px;padding-top:16px;color:#9aa3b2}
    /* 왼쪽 리스트 */
    #filter{width:100%;padding:10px 12px;border-radius:12px;border:1px solid #1f2937;background:#0b1220;color:var(--text);margin-bottom:10px}
    #company-list{list-style:none;padding:0;margin:0;max-height:540px;overflow:auto}
    #company-list li{padding:10px 12px;border:1px solid #1f2937;border-radius:12px;margin-bottom:8px;cursor:pointer;display:flex;justify-content:space-between;align-items:center;gap:8px;background:#0b1220}
    #company-list li:hover{border-color:#243043}
    #company-list li.active{outline:2px solid var(--accent); background:#0c1625}
    .ticker{font-weight:700}
    .name{font-size:12px;color:#9aa3b2}
    /* 뉴스 리스트 */
    #news-list{list-style:none;padding:0;margin:8px 0;display:grid;gap:10px}
    #news-list li a{font-weight:600}
    #news-list .date{font-size:12px;color:#9aa3b2}
  </style>
</head>
<body>
  <header>
    <div class="container">
      <nav>
        <div class="brand">내 홈페이지<span class="logo-dot" style="width:10px;height:10px;background:var(--accent-2);display:inline-block;border-radius:50%;margin-left:6px"></span></div>
        <div class="navlinks">
          <a href="/">Home</a>
          <a href="/stock.html">Stock Market</a>
          <a href="/matjip.html">맛집</a>
          <a href="/#contact" class="btn primary">문의하기</a>
        </div>
      </nav>
    </div>
  </header>

  <main class="container">
    <div class="grid cols-2">
      <!-- 좌: S&P 대표 기업 목록 -->
      <aside class="card">
        <div class="section-title"><div class="bar"></div><h2 style="margin:0">S&P 대표 종목</h2></div>
        <input id="filter" type="text" placeholder="티커/이름 검색 (예: AAPL, NVIDIA)" />
        <ul id="company-list"></ul>
        <p class="muted" style="margin-top:6px">클릭하면 오른쪽에 <b>차트 & 최신 뉴스(5)</b>가 바뀝니다.</p>
      </aside>

      <!-- 우: 차트 + 뉴스 -->
      <section class="card" style="padding:0">
        <div style="padding:18px 18px 0">
          <div class="section-title"><div class="bar"></div><h2 id="panel-title" style="margin:0">SPY — S&P 500 ETF</h2></div>
        </div>
        <div id="tvchart" style="height:520px"></div>

        <div style="padding:0 18px 18px">
          <div class="section-title" style="margin-top:8px"><div class="bar"></div><h3 style="margin:0">최신 뉴스</h3></div>
          <ul id="news-list"><li class="muted">좌측에서 종목을 선택하세요.</li></ul>
          <div class="muted" style="font-size:12px">* 매일 1회 자동 갱신 (Google News RSS 기반)</div>
        </div>
      </section>
    </div>

    <div class="footer">
      <small>© <span id="year"></span> 내 홈페이지 · 모든 권리 보유</small>
    </div>
  </main>

  <!-- TradingView Advanced Chart -->
  <script src="https://s3.tradingview.com/tv.js"></script>
  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== 좌측 목록 데이터 (티커=key, 차트심볼=symbol, 표시이름=name) =====
    const COMPANIES = [
      { key: 'SPY',   symbol: 'AMEX:SPY',   name: 'S&P 500 ETF' },
      { key: 'AAPL',  symbol: 'NASDAQ:AAPL',name: 'Apple' },
      { key: 'MSFT',  symbol: 'NASDAQ:MSFT',name: 'Microsoft' },
      { key: 'NVDA',  symbol: 'NASDAQ:NVDA',name: 'NVIDIA' },
      { key: 'GOOGL', symbol: 'NASDAQ:GOOGL',name: 'Alphabet (Class A)' },
      { key: 'AMZN',  symbol: 'NASDAQ:AMZN',name: 'Amazon' },
      { key: 'META',  symbol: 'NASDAQ:META',name: 'Meta Platforms' },
      { key: 'BRK.B', symbol: 'NYSE:BRK.B', name: 'Berkshire Hathaway B' },
      { key: 'JPM',   symbol: 'NYSE:JPM',   name: 'JPMorgan Chase' },
      { key: 'UNH',   symbol: 'NYSE:UNH',   name: 'UnitedHealth' },
      { key: 'XOM',   symbol: 'NYSE:XOM',   name: 'Exxon Mobil' },
      { key: 'AVGO',  symbol: 'NASDAQ:AVGO',name: 'Broadcom' },
      { key: 'JNJ',   symbol: 'NYSE:JNJ',   name: 'Johnson & Johnson' },
      { key: 'TSLA',  symbol: 'NASDAQ:TSLA',name: 'Tesla' },
      { key: 'V',     symbol: 'NYSE:V',     name: 'Visa' },
      { key: 'PG',    symbol: 'NYSE:PG',    name: 'Procter & Gamble' },
      { key: 'LLY',   symbol: 'NYSE:LLY',   name: 'Eli Lilly' },
      { key: 'HD',    symbol: 'NYSE:HD',    name: 'Home Depot' },
      { key: 'KO',    symbol: 'NYSE:KO',    name: 'Coca-Cola' },
      { key: 'PEP',   symbol: 'NASDAQ:PEP', name: 'PepsiCo' }
    ];

    // 프로젝트 페이지/커스텀 도메인 모두 호환되는 news 경로 계산
    const basePrefix = (() => {
      const isGithubPages = location.hostname.endsWith('github.io');
      const m = location.pathname.match(/^\/([^\/]+)\//);
      return (isGithubPages && m) ? `/${m[1]}` : '';
    })();
    const newsURL = (key) => `${basePrefix}/news/${encodeURIComponent(key)}.json`;

    // 좌측 목록 렌더 + 필터
    const listEl = document.getElementById('company-list');
    const filterEl = document.getElementById('filter');
    function renderList(q='') {
      const needle = q.trim().toLowerCase();
      listEl.innerHTML = '';
      COMPANIES
        .filter(c => !needle || c.key.toLowerCase().includes(needle) || c.name.toLowerCase().includes(needle))
        .forEach(c => {
          const li = document.createElement('li');
          li.dataset.ticker = c.key;
          li.dataset.symbol = c.symbol;
          li.innerHTML = `<span><span class="ticker">${c.key}</span> <span class="name">— ${c.name}</span></span>`;
          li.addEventListener('click', () => selectCompany(c));
          listEl.appendChild(li);
        });
    }
    filterEl.addEventListener('input', e => renderList(e.target.value));
    renderList(); // 초기 렌더

    // TradingView 차트
    let tv;
    function initChart(symbol = "AMEX:SPY", interval = "D") {
      const container = document.getElementById("tvchart");
      container.innerHTML = "";
      tv = new TradingView.widget({
        container_id: "tvchart",
        symbol, interval, timezone: "Asia/Seoul",
        theme: "dark", style: "1", withdateranges: true,
        hide_side_toolbar: false, allow_symbol_change: true,
        autosize: true, locale: "ko",
        watchlist: COMPANIES.map(c => c.symbol)
      });
    }
    initChart();

    // 뉴스 로드
    async function loadNews(key) {
      const ul = document.getElementById('news-list');
      ul.innerHTML = '<li class="muted">불러오는 중…</li>';
      try {
        const res = await fetch(newsURL(key), { cache: 'no-cache' });
        if (!res.ok) throw new Error('뉴스 파일이 없습니다.');
        const items = await res.json();
        ul.innerHTML = '';
        (items.slice(0,5)).forEach(it => {
          const d = new Date(it.pubDate);
          const li = document.createElement('li');
          li.innerHTML = `<a href="${it.link}" target="_blank" rel="noopener">${it.title}</a><br/><span class="date">${d.toLocaleString('ko-KR')}</span>`;
          ul.appendChild(li);
        });
        if (!items.length) ul.innerHTML = '<li class="muted">최근 24시간 내 기사 없음</li>';
      } catch (e) {
        ul.innerHTML = '<li class="muted">뉴스를 불러오지 못했습니다. (Actions 세팅 확인)</li>';
        console.error(e);
      }
    }

    // 선택 동작: 리스트 active, 타이틀, 차트, 뉴스 동시 업데이트
    function selectCompany(c) {
      // active 표시
      Array.from(listEl.children).forEach(li => li.classList.toggle('active', li.dataset.ticker === c.key));
      document.getElementById('panel-title').textContent = `${c.key} — ${c.name}`;

      // 차트 심볼 변경
      const interval = (tv && tv.symbolInterval) ? tv.symbolInterval().interval : "D";
      if (tv && typeof tv.onChartReady === "function") {
        tv.onChartReady(() => tv.chart().setSymbol(c.symbol));
      } else {
        initChart(c.symbol, interval);
      }

      // 뉴스 로드
      loadNews(c.key);
    }

    // 초기 선택: SPY
    selectCompany(COMPANIES[0]);
  </script>
</body>
</html>

