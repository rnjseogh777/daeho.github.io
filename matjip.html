<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>맛집 — 내 홈페이지</title>
  <meta name="description" content="여의도 태영빌딩 주변 맛집 지도 & 분류 필터"/>
  <style>
    :root{ --bg:#0f172a; --panel:#111827ee; --text:#e5e7eb; --muted:#9aa3af; --accent:#60a5fa; --accent-2:#34d399; --border:#1f2937;}
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;background:radial-gradient(1200px 800px at 80% -10%,#1f2937 0%,#0b1225 50%,#020617 100%);color:var(--text)}
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline;opacity:.9}
    .container{max-width:1200px;margin:0 auto;padding:20px}
    header{position:sticky;top:0;backdrop-filter:saturate(140%) blur(8px);background:#030712aa;border-bottom:1px solid #111827;z-index:50}
    nav{display:flex;justify-content:space-between;align-items:center;gap:16px}
    .brand{font-weight:800;letter-spacing:.2px}
    .brand span{color:var(--accent)}
    .navlinks{display:flex;gap:18px;flex-wrap:wrap}
    .btn{display:inline-block;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:#0b1220}
    .btn.primary{background:linear-gradient(135deg,var(--accent),#7dd3fc);color:#02131e;border-color:transparent;font-weight:700}
    .grid{display:grid;gap:18px}
    @media(min-width:1024px){ .grid.cols-2{grid-template-columns:1fr 480px} }  /* 좌:지도, 우:패널(데스크탑) */
    .card{background:linear-gradient(180deg,#0b1220 0%,#0a0f1a 100%);border:1px solid var(--border);border-radius:18px;padding:18px}
    .section-title{display:flex;align-items:center;gap:10px;margin:0 0 12px}
    .section-title .bar{width:28px;height:2px;background:var(--accent);opacity:.8}
    .muted{color:#9aa3b2}
    .footer{border-top:1px solid #111827;margin-top:28px;padding-top:16px;color:#9aa3b2}

    /* 우측 패널 */
    .filters{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:10px}
    .chip{padding:8px 12px;border-radius:999px;border:1px solid var(--border);cursor:pointer;background:#0b1220;font-size:14px}
    .chip.active{outline:2px solid var(--accent);background:#0c1625}
    #place-list{list-style:none;padding:0;margin:0;display:grid;gap:10px;max-height:420px;overflow:auto}
    #place-list li{padding:10px 12px;border:1px solid var(--border);border-radius:12px;background:#0b1220;cursor:pointer}
    #place-list li:hover{border-color:#243043}
    #place-list .title{font-weight:700}
    #place-list .cat{font-size:12px;color:#9aa3b2}
    #detail{margin-top:12px;border-top:1px solid var(--border);padding-top:12px}
    #map{height:600px;border-radius:14px;overflow:hidden}
    @media(max-width:1023px){ #map{height:380px} }
  </style>
</head>
<body>
<header>
  <div class="container">
    <nav>
      <div class="brand">내 홈페이지<span class="logo-dot" style="width:10px;height:10px;background:var(--accent-2);display:inline-block;border-radius:50%;margin-left:6px"></span></div>
      <div class="navlinks">
        <a href="/">Home</a>
        <a href="/stock.html">Stock Market</a>
        <a href="/matjip.html">맛집</a>
        <a href="/#contact" class="btn primary">문의하기</a>
      </div>
    </nav>
  </div>
</header>

<main class="container">
  <div class="grid cols-2">
    <!-- 왼쪽: 지도 -->
    <section class="card" style="padding:12px">
      <div class="section-title"><div class="bar"></div><h2 style="margin:0">여의도 태영빌딩 중심 지도</h2></div>
      <div id="map"></div>
      <p class="muted" style="margin-top:8px">* 반경 내 음식점을 자동으로 불러옵니다. (카카오 지도)</p>
    </section>

    <!-- 오른쪽: 목록 + 상세 -->
    <aside class="card">
      <div class="section-title"><div class="bar"></div><h2 style="margin:0">주변 맛집</h2></div>

      <div class="filters" id="filters">
        <!-- 동적 생성: 전체/한식/중식/일식/양식/카페/기타 -->
      </div>

      <ul id="place-list">
        <li class="muted">지도를 불러오는 중…</li>
      </ul>

      <div id="detail"></div>
    </aside>
  </div>

  <div class="footer">
    <small>© <span id="year"></span> 내 홈페이지 · 모든 권리 보유</small>
  </div>
</main>

<!-- Kakao Maps JS (services=Places/Geocoder) -->
<script src="https://dapi.kakao.com/v2/maps/sdk.js?appkey=6096c5ef0866cfa555f1040e3f21bc62&libraries=services"></script>
<script>
  document.getElementById('year').textContent = new Date().getFullYear();

  // ----- 1) 카테고리 정의/매핑 -----
  const CATEGORIES = ['전체','한식','중식','일식','양식','카페','기타'];
  function mapCuisine(catName=''){
    const c = catName.toLowerCase();
    if (c.includes('한식') || c.includes('분식') || c.includes('치킨') || c.includes('고기') || c.includes('국밥')) return '한식';
    if (c.includes('중식') || c.includes('중화')) return '중식';
    if (c.includes('일식') || c.includes('스시') || c.includes('돈까스') || c.includes('라멘')) return '일식';
    if (c.includes('양식') || c.includes('이탈리아') || c.includes('피자') || c.includes('버거') || c.includes('스테이크') || c.includes('파스타')) return '양식';
    if (c.includes('카페') || c.includes('디저트') || c.includes('제과')) return '카페';
    return '기타';
  }

  // ----- 2) 지도 초기화(태영빌딩 주소→좌표) -----
  const geocoder = new kakao.maps.services.Geocoder();
  const mapEl = document.getElementById('map');
  const map = new kakao.maps.Map(mapEl, { center: new kakao.maps.LatLng(37.523, 126.926), level: 4 }); // 임시 중심(여의도), 곧 재중심

  geocoder.addressSearch('서울 영등포구 여의공원로 111', (res, status) => {
    if (status === kakao.maps.services.Status.OK && res[0]) {
      const { y, x } = res[0]; // (lat=y, lng=x)
      const center = new kakao.maps.LatLng(y, x);
      map.setCenter(center);
      // 마커: 태영빌딩
      new kakao.maps.Marker({ map, position: center, title: '태영빌딩' });
      loadPlaces(center);
    } else {
      // 지오코딩 실패 시 여의도 중앙 기준으로라도 검색
      loadPlaces(map.getCenter());
    }
  });

  // ----- 3) 장소 검색(카테고리: 음식점 FD6, 반경 800m) -----
  const places = new kakao.maps.services.Places(map);
  let ALL_RESULTS = [];     // 원본
  let MARKERS = [];         // 지도 마커(필터 시 토글)
  let CURRENT_FILTER = '전체';

  function clearMarkers(){
    MARKERS.forEach(m => m.setMap(null));
    MARKERS = [];
  }

  function loadPlaces(center){
    // 페이지네이션 포함 수집
    ALL_RESULTS = [];
    clearMarkers();
    const opts = { location: center, radius: 800 }; // 800m 반경
    const accum = (data, status, _pag) => {
      if (status === kakao.maps.services.Status.OK) {
        ALL_RESULTS = ALL_RESULTS.concat(data);
        // 더 불러올 페이지가 있으면 계속
        if (_pag && _pag.hasNextPage) {
          _pag.nextPage();
        } else {
          renderFilterChips();
          renderList();    // 목록
          renderMarkers(); // 마커
        }
      } else {
        document.getElementById('place-list').innerHTML = '<li class="muted">주변에서 식당을 찾지 못했습니다.</li>';
      }
    };
    places.categorySearch('FD6', accum, opts);
  }

  // ----- 4) 필터/목록/상세/마커 -----
  function byFilter(item){
    if (CURRENT_FILTER === '전체') return true;
    return mapCuisine(item.category_name) === CURRENT_FILTER;
  }

  function renderFilterChips(){
    const box = document.getElementById('filters');
    box.innerHTML = '';
    CATEGORIES.forEach(cat => {
      const el = document.createElement('button');
      el.className = 'chip' + (cat===CURRENT_FILTER ? ' active' : '');
      el.textContent = cat;
      el.addEventListener('click', () => {
        CURRENT_FILTER = cat;
        document.querySelectorAll('.chip').forEach(c=>c.classList.remove('active'));
        el.classList.add('active');
        renderList();
        renderMarkers();
        document.getElementById('detail').innerHTML = '';
      });
      box.appendChild(el);
    });
  }

  function renderList(){
    const ul = document.getElementById('place-list');
    const items = ALL_RESULTS.filter(byFilter);
    if (!items.length) {
      ul.innerHTML = '<li class="muted">해당 분류의 식당이 없습니다.</li>';
      return;
    }
    ul.innerHTML = '';
    items.forEach(item => {
      const li = document.createElement('li');
      li.innerHTML = `
        <div class="title">${item.place_name}</div>
        <div class="cat">${item.category_name} · ${item.road_address_name || item.address_name || ''}</div>
      `;
      li.addEventListener('click', () => showDetail(item));
      ul.appendChild(li);
    });
  }

  function renderMarkers(){
    clearMarkers();
    const items = ALL_RESULTS.filter(byFilter);
    const bounds = new kakao.maps.LatLngBounds();
    items.forEach(item => {
      const pos = new kakao.maps.LatLng(item.y, item.x);
      const marker = new kakao.maps.Marker({ map, position: pos, title: item.place_name });
      kakao.maps.event.addListener(marker, 'click', () => showDetail(item));
      MARKERS.push(marker);
      bounds.extend(pos);
    });
    if (items.length) map.setBounds(bounds, 40, 40, 40, 40);
  }

  // 메뉴 데이터(선택): /data/menus.json에서 id 또는 (이름+전화) 매칭
  let MENU_MAP = null;
  fetch('/data/menus.json').then(r => r.ok ? r.json() : null).then(j => MENU_MAP = j).catch(()=>{});

  function showDetail(item){
    const box = document.getElementById('detail');
    const cuisine = mapCuisine(item.category_name);
    const tel = item.phone ? item.phone : '전화정보 없음';
    const addr = item.road_address_name || item.address_name || '';
    const naverLink = `https://map.naver.com/v5/search/${encodeURIComponent(item.place_name)}`;
    const googleLink = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(item.place_name + ' ' + addr)}`;

    // 메뉴: 기본은 Kakao place_url로 안내, 커스텀 menus.json 있으면 표시
    let menuHTML = `<div class="muted">* 메뉴는 외부 페이지를 참고하세요.</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:6px">
        <a class="btn" href="${item.place_url}" target="_blank" rel="noopener">카카오에서 보기</a>
        <a class="btn" href="${naverLink}" target="_blank" rel="noopener">네이버에서 보기</a>
        <a class="btn" href="${googleLink}" target="_blank" rel="noopener">구글에서 보기</a>
      </div>`;

    if (MENU_MAP) {
      const key = item.id || (item.place_name + (item.phone||'')).toLowerCase();
      const custom = MENU_MAP[key];
      if (custom && Array.isArray(custom) && custom.length) {
        menuHTML = `<ul style="list-style:none;padding:0;margin-top:6px;display:grid;gap:6px">
          ${custom.map(m => `<li>· ${m.name}${m.price ? ` — <span class="muted">${m.price}</span>`:''}</li>`).join('')}
        </ul>`;
      }
    }

    box.innerHTML = `
      <div class="section-title"><div class="bar"></div><h3 style="margin:0">${item.place_name}</h3></div>
      <p class="muted" style="margin:4px 0 10px">${item.category_name} · 분류: ${cuisine}</p>
      <p style="margin:0 0 6px">주소: ${addr}</p>
      <p style="margin:0 0 10px">전화: ${tel}</p>
      <div><strong>메뉴</strong>${menuHTML}</div>
    `;
  }
</script>
</body>
</html>
